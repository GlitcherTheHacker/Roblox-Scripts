-- ⚡ USE TOOLS SELECTOR GUI (Fixed + Upgraded) ⚡

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- === GUI SETUP ===
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "UseToolsSelector"
screenGui.ResetOnSpawn = false
screenGui.Parent = game.CoreGui

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 200, 0, 300)
mainFrame.Position = UDim2.new(0, 20, 0.4, -150)
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 10)

local header = Instance.new("TextLabel")
header.Size = UDim2.new(1, 0, 0, 30)
header.BackgroundColor3 = Color3.fromRGB(40, 0, 60)
header.TextColor3 = Color3.fromRGB(255, 255, 255)
header.Text = "⚡ Use Tools ⚡"
header.Font = Enum.Font.GothamBold
header.TextSize = 16
header.Parent = mainFrame
Instance.new("UICorner", header).CornerRadius = UDim.new(0, 10)

local scrollingFrame = Instance.new("ScrollingFrame")
scrollingFrame.Size = UDim2.new(1, -10, 1, -70)
scrollingFrame.Position = UDim2.new(0, 5, 0, 35)
scrollingFrame.BackgroundTransparency = 1
scrollingFrame.BorderSizePixel = 0
scrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
scrollingFrame.ScrollBarThickness = 6
scrollingFrame.Parent = mainFrame

local layout = Instance.new("UIListLayout")
layout.Parent = scrollingFrame
layout.Padding = UDim.new(0, 5)

local function updateCanvas()
    scrollingFrame.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 10)
end
layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateCanvas)

-- === TOOL MANAGER ===
local toolButtons = {}
local activeTools = {}

-- Equip tool helper
local function equipTool(tool)
    if tool and tool.Parent == LocalPlayer.Backpack then
        tool.Parent = LocalPlayer.Character
    end
end

-- Unequip tool helper
local function unequipTool(tool)
    if tool and tool.Parent == LocalPlayer.Character then
        tool.Parent = LocalPlayer.Backpack
    end
end

-- Spam loop
RunService.Heartbeat:Connect(function()
    local char = LocalPlayer.Character
    if not char then return end
    for tool, enabled in pairs(activeTools) do
        if enabled then
            if tool.Parent ~= char then
                equipTool(tool)
            end
            pcall(function() tool:Activate() end)
        end
    end
end)

-- Create toggle button
local function createToolButton(tool)
    if toolButtons[tool] then return end

    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, -10, 0, 30)
    button.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Text = tool.Name .. " [OFF]"
    button.Font = Enum.Font.Gotham
    button.TextSize = 14
    button.Parent = scrollingFrame
    Instance.new("UICorner", button).CornerRadius = UDim.new(0, 6)

    activeTools[tool] = false

    button.MouseButton1Click:Connect(function()
        activeTools[tool] = not activeTools[tool]
        if activeTools[tool] then
            equipTool(tool)
            button.Text = tool.Name .. " [ON]"
            button.BackgroundColor3 = Color3.fromRGB(60, 0, 90)
        else
            unequipTool(tool)
            button.Text = tool.Name .. " [OFF]"
            button.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        end
    end)

    -- Auto-cleanup
    tool.AncestryChanged:Connect(function(_, parent)
        if not parent then
            activeTools[tool] = nil
            toolButtons[tool] = nil
            button:Destroy()
        end
    end)

    toolButtons[tool] = button
end

-- Refresh tools
local function refreshTools()
    for _, tool in ipairs(LocalPlayer.Backpack:GetChildren()) do
        if tool:IsA("Tool") then createToolButton(tool) end
    end
    if LocalPlayer.Character then
        for _, tool in ipairs(LocalPlayer.Character:GetChildren()) do
            if tool:IsA("Tool") then createToolButton(tool) end
        end
    end
end

-- Tool listeners
LocalPlayer.Backpack.ChildAdded:Connect(function(tool)
    if tool:IsA("Tool") then createToolButton(tool) end
end)
LocalPlayer.CharacterAdded:Connect(function(char)
    char.ChildAdded:Connect(function(tool)
        if tool:IsA("Tool") then createToolButton(tool) end
    end)
end)

refreshTools()

-- === CONTROL BUTTONS ===
local useAllBtn = Instance.new("TextButton")
useAllBtn.Size = UDim2.new(0.45, 0, 0, 30)
useAllBtn.Position = UDim2.new(0, 5, 1, -35)
useAllBtn.BackgroundColor3 = Color3.fromRGB(0, 100, 0)
useAllBtn.Text = "Use All"
useAllBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
useAllBtn.Font = Enum.Font.GothamBold
useAllBtn.TextSize = 14
useAllBtn.Parent = mainFrame
Instance.new("UICorner", useAllBtn).CornerRadius = UDim.new(0, 6)

useAllBtn.MouseButton1Click:Connect(function()
    for tool, btn in pairs(toolButtons) do
        activeTools[tool] = true
        equipTool(tool)
        btn.Text = tool.Name .. " [ON]"
        btn.BackgroundColor3 = Color3.fromRGB(60, 0, 90)
    end
end)

local stopAllBtn = Instance.new("TextButton")
stopAllBtn.Size = UDim2.new(0.45, 0, 0, 30)
stopAllBtn.Position = UDim2.new(1, -95, 1, -35)
stopAllBtn.BackgroundColor3 = Color3.fromRGB(100, 0, 0)
stopAllBtn.Text = "Stop All"
stopAllBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
stopAllBtn.Font = Enum.Font.GothamBold
stopAllBtn.TextSize = 14
stopAllBtn.Parent = mainFrame
Instance.new("UICorner", stopAllBtn).CornerRadius = UDim.new(0, 6)

stopAllBtn.MouseButton1Click:Connect(function()
    for tool, btn in pairs(toolButtons) do
        activeTools[tool] = false
        unequipTool(tool)
        btn.Text = tool.Name .. " [OFF]"
        btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    end
end)

print("⚡ USE TOOLS SELECTOR GUI (Fixed) Loaded ⚡")
