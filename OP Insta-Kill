-- ⚡ Insta-Kill Aura Ultra (Ping-Safe & Optimized)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- CONFIG
local AURA_RANGE = 20
local AURA_BOX = Vector3.new(30, 30, 30)
local ACTIVE = true

-- PREP
local auraParams = OverlapParams.new()
auraParams.FilterType = Enum.RaycastFilterType.Include

local function getChar(plr)
    return plr and plr.Character or nil
end

local function getHRP(plr)
    local char = getChar(plr)
    return char and char:FindFirstChild("HumanoidRootPart")
end

local function getTargets()
    local char = getChar(LocalPlayer)
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if not hrp then return {} end

    local t = {}
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer then
            local hrp2 = getHRP(plr)
            if hrp2 and (hrp2.Position - hrp.Position).Magnitude <= AURA_RANGE then
                table.insert(t, plr)
            end
        end
    end
    return t
end

local function equipTools(char)
    for _, tool in ipairs(LocalPlayer.Backpack:GetChildren()) do
        if tool:IsA("Tool") then
            tool.Parent = char
        end
    end
end

local function fastActivate(tool)
    task.spawn(function()
        tool:Activate()
    end)
end

-- MAIN LOOP
task.spawn(function()
    while ACTIVE do
        local char = getChar(LocalPlayer)
        if not char then
            RunService.PostSimulation:Wait()
            continue
        end
        equipTools(char)

        local hrp = getHRP(LocalPlayer)
        if not hrp then
            RunService.PostSimulation:Wait()
            continue
        end

        local targets = getTargets()
        local enemyModels = {}
        for _, p in ipairs(targets) do
            if p.Character then table.insert(enemyModels, p.Character) end
        end
        auraParams.FilterDescendantsInstances = enemyModels

        for _, tool in ipairs(char:GetChildren()) do
            if tool:IsA("Tool") then
                local fightEvent = tool:FindFirstChild("FightEvent")
                local touchPart = tool:FindFirstChildWhichIsA("BasePart", true)

                if fightEvent then
                    for _, plr in ipairs(targets) do
                        pcall(function()
                            fightEvent:FireServer(getHRP(plr))
                        end)
                    end
                    fastActivate(tool)
                end

                if touchPart then
                    local hits = workspace:GetPartBoundsInBox(
                        touchPart.CFrame,
                        touchPart.Size + AURA_BOX,
                        auraParams
                    )
                    for _, part in ipairs(hits) do
                        local mdl = part:FindFirstAncestorWhichIsA("Model")
                        if mdl and table.find(enemyModels, mdl) then
                            firetouchinterest(touchPart, part, 1)
                            firetouchinterest(touchPart, part, 0)
                        end
                    end
                end
            end
        end

        -- frame-accurate, safe delay
        RunService.PostSimulation:Wait()
    end
end)

-- Reset on death
LocalPlayer.CharacterAdded:Connect(function()
    task.wait(1)
    ACTIVE = true
end)

print("✅ Insta-Kill Aura Ultra loaded (max speed, ping-safe)")
