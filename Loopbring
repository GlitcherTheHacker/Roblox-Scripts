--// SERVICES //--
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer
local GuideRemote = ReplicatedStorage:FindFirstChild("Guide")

--// SHARED LOOPBRING TARGET LIST //--
bringTargets = bringTargets or {} -- Shared globally

local distance = 2

--  GUI BUILD
 
local gui = Instance.new("ScreenGui")
gui.Name = "LoopbringGUI"
gui.ResetOnSpawn = false
gui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local toggleBtn = Instance.new("TextButton")
toggleBtn.Parent = gui
toggleBtn.Size = UDim2.new(0, 40, 0, 40)
toggleBtn.Position = UDim2.new(1, -50, 0, 100)
toggleBtn.Text = "⇩"
toggleBtn.TextScaled = true
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.BackgroundColor3 = Color3.fromRGB(40, 0, 0)
toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(1, 0)

local frame = Instance.new("Frame")
frame.Parent = gui
frame.Position = UDim2.new(1, -250, 0, 145)
frame.Size = UDim2.new(0, 220, 0, 310)
frame.BackgroundColor3 = Color3.fromRGB(25, 5, 5)
frame.Visible = false
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)
Instance.new("UIStroke", frame).Color = Color3.fromRGB(200, 0, 0)

--  PLAYER BUTTON LIST
 
local header = Instance.new("Frame", frame)
header.Size = UDim2.new(1, 0, 0, 40)
header.BackgroundTransparency = 1

local distanceLabel = Instance.new("TextLabel", header)
distanceLabel.Size = UDim2.new(1, 0, 1, 0)
distanceLabel.Text = "Distance: " .. distance
distanceLabel.TextColor3 = Color3.fromRGB(255, 120, 120)
distanceLabel.TextScaled = true
distanceLabel.Font = Enum.Font.GothamBold
distanceLabel.BackgroundTransparency = 1

local scroll = Instance.new("ScrollingFrame", frame)
scroll.Position = UDim2.new(0, 0, 0, 50)
scroll.Size = UDim2.new(1, 0, 1, -100)
scroll.BackgroundTransparency = 1
scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
scroll.ScrollBarThickness = 5

local layout = Instance.new("UIListLayout", scroll)
layout.Padding = UDim.new(0, 3)

--  LOOPBRING CORE
 
local function updateTeleport()
	local myChar = LocalPlayer.Character
	local myRoot = myChar and myChar:FindFirstChild("HumanoidRootPart")
	if not myRoot then return end

	for _, name in ipairs(bringTargets) do
		local plr = Players:FindFirstChild(name)
		if plr and plr.Character then
			local char = plr.Character
			local root = char:FindFirstChild("HumanoidRootPart")
			if root then
				root.CFrame = CFrame.new(myRoot.Position + myRoot.CFrame.LookVector * distance)
			end
		end
	end
end

local function loopBring(name)
	if table.find(bringTargets, name) then return end
	table.insert(bringTargets, name)

	task.spawn(function()
		while table.find(bringTargets, name) do
			updateTeleport()
			task.wait(0.05)
		end
	end)
end

local function stopBring(name)
	local i = table.find(bringTargets, name)
	if i then table.remove(bringTargets, i) end
end

--  GUI LIST
 
local function refreshList()
	for _, c in ipairs(scroll:GetChildren()) do
		if c:IsA("TextButton") then c:Destroy() end
	end
	for _, p in ipairs(Players:GetPlayers()) do
		if p ~= LocalPlayer then
			local btn = Instance.new("TextButton")
			btn.Parent = scroll
			btn.Size = UDim2.new(1, -8, 0, 28)
			btn.Text = p.Name
			btn.Font = Enum.Font.Gotham
			btn.TextScaled = true
			btn.BackgroundColor3 = Color3.fromRGB(40, 0, 0)
			btn.TextColor3 = table.find(bringTargets, p.Name)
				and Color3.fromRGB(255, 80, 80)
				or Color3.fromRGB(0, 255, 0)
			Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)
			btn.MouseButton1Click:Connect(function()
				if table.find(bringTargets, p.Name) then stopBring(p.Name) else loopBring(p.Name) end
				refreshList()
			end)
		end
	end
	scroll.CanvasSize = UDim2.new(0, 0, 0, #Players:GetPlayers() * 32)
end

refreshList()
Players.PlayerAdded:Connect(refreshList)
Players.PlayerRemoving:Connect(function(p) stopBring(p.Name) refreshList() end)

--  ✅ ENEMY LAG BURST BUTTON ADDED HERE
 
local lagBtn = Instance.new("TextButton", frame)
lagBtn.Size = UDim2.new(1, -8, 0, 40)
lagBtn.Position = UDim2.new(0, 4, 1, -45)
lagBtn.Text = "⚡ LAG ENEMIES"
lagBtn.TextScaled = true
lagBtn.Font = Enum.Font.GothamBold
lagBtn.BackgroundColor3 = Color3.fromRGB(120, 0, 0)
lagBtn.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", lagBtn).CornerRadius = UDim.new(0, 8)

local function lagEnemies()
	if not GuideRemote then return warn("No Guide remote found!") end
	if #bringTargets == 0 then return warn("No loopbrung players to lag!") end

	print("⚠ Lag burst activated!")
	local start = tick()
	while tick() - start < 4 do
		for _, enemyName in ipairs(bringTargets) do
			local enemy = Players:FindFirstChild(enemyName)
			if enemy then pcall(function() GuideRemote:FireServer(enemy) end) end
		end
		task.wait(0.01)
	end
	print("✅ Lag burst finished.")
end

lagBtn.MouseButton1Click:Connect(lagEnemies)

--  UI TOGGLE

toggleBtn.MouseButton1Click:Connect(function()
	frame.Visible = not frame.Visible
end)

print("Loopbring Initilized - Use The new Lag burst Section to try and escape enemy grasp")
