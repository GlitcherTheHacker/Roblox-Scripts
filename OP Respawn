-- ⚡ ULTRA-INSTANT RESPAWN (Frame-Edge, Single-Call, Perfect Sync)

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

local function forceRespawn()
	if LocalPlayer:FindFirstChild("LoadCharacter") then
		LocalPlayer:LoadCharacter()
	elseif ReplicatedStorage:FindFirstChild("Guide") then
		ReplicatedStorage.Guide:FireServer()
	end
end

local function hookCharacter(char)
	local humanoid = char:WaitForChild("Humanoid", 0.5)
	if not humanoid then return end

	local respawned = false
	local function safeRespawn()
		if not respawned then
			respawned = true
			forceRespawn()
		end
	end

	-- Primary: detect immediate health drop
	humanoid:GetPropertyChangedSignal("Health"):Connect(function()
		if humanoid.Health <= 0 then
			safeRespawn()
		end
	end)

	-- Backup: death event
	humanoid.Died:Connect(safeRespawn)

	-- Frame-edge check (Heartbeat fires right as health hits 0)
	local hbConn
	hbConn = RunService.Heartbeat:Connect(function()
		if humanoid.Health <= 0 then
			hbConn:Disconnect()
			safeRespawn()
		end
	end)

	-- Fallback: humanoid removed
	char.ChildRemoved:Connect(function(c)
		if c == humanoid then
			if hbConn then hbConn:Disconnect() end
			safeRespawn()
		end
	end)
end

LocalPlayer.CharacterAdded:Connect(hookCharacter)
if LocalPlayer.Character then
	hookCharacter(LocalPlayer.Character)
else
	forceRespawn()
end

print("✅ ULTRA-INSTANT RESPAWN loaded (frame-edge, single trigger)")
