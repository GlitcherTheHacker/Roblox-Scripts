-- ⚡ Ultra Respawn (Frame-Safe, Single-Call)
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

local function forceRespawn()
	if LocalPlayer:FindFirstChild("LoadCharacter") then
		LocalPlayer:LoadCharacter()
	elseif ReplicatedStorage:FindFirstChild("Guide") then
		ReplicatedStorage.Guide:FireServer()
	end
end

local function hookCharacter(char)
	local humanoid = char:WaitForChild("Humanoid", 1)
	if not humanoid then return end

	-- Only run once when dead
	local respawned = false
	local function safeRespawn()
		if not respawned then
			respawned = true
			forceRespawn()
		end
	end

	humanoid.Died:Connect(safeRespawn)

	-- Backup check (frame-perfect)
	local hbConn
	hbConn = RunService.Heartbeat:Connect(function()
		if humanoid.Health <= 0 then
			hbConn:Disconnect()
			safeRespawn()
		end
	end)

	-- Fallback: Humanoid removed
	char.ChildRemoved:Connect(function(c)
		if c == humanoid then
			if hbConn then hbConn:Disconnect() end
			safeRespawn()
		end
	end)
end

LocalPlayer.CharacterAdded:Connect(hookCharacter)
if LocalPlayer.Character then
	hookCharacter(LocalPlayer.Character)
else
	forceRespawn()
end

print("✅ Ultra Respawn loaded (instant, safe, single-call)")
