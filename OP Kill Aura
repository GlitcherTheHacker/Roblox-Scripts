-- CONFIG
local auraRange = 20       -- distance to hit players
local attackRate = 0.1     -- seconds between attacks

-- SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- STATE
local running = true

-- GET PLAYER CHARACTER
local function GetCharacter(player)
    return player and player.Character
end

-- GET TARGETS IN RANGE
local function GetTargets()
    local targets = {}
    local myChar = GetCharacter(LocalPlayer)
    if not myChar then return targets end

    local hrp = myChar:FindFirstChild("HumanoidRootPart")
    if not hrp then return targets end

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local char = GetCharacter(player)
            local targetHRP = char and char:FindFirstChild("HumanoidRootPart")
            if targetHRP and (targetHRP.Position - hrp.Position).Magnitude <= auraRange then
                table.insert(targets, targetHRP)
            end
        end
    end

    return targets
end

-- MAIN LOOP
task.spawn(function()
    while running do
        local char = GetCharacter(LocalPlayer)
        if char then
            -- Fire all FightEvents for tools with a FightEvent
            for _, tool in ipairs(char:GetChildren()) do
                if tool:IsA("Tool") and tool:FindFirstChild("FightEvent") then
                    for _, target in ipairs(GetTargets()) do
                        -- Fire server with target (no touching needed)
                        pcall(function()
                            tool.FightEvent:FireServer(target)
                        end)
                    end
                end
            end
        end
        task.wait(attackRate)
    end
end)

-- RESET ON DEATH
LocalPlayer.CharacterAdded:Connect(function()
    task.wait(1)
    running = true
end)
