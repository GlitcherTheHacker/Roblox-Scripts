-- CONFIG
local auraRange = 20 -- Distance to target players
local attackRate = 0.01 -- Seconds between each attack per tool

-- SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- STATE
local running = true

-- GET PLAYER CHAR
local function GetCharacter(player)
	return player and player.Character
end

-- GET ENEMIES IN RANGE
local function GetTargets()
	local targets = {}
	local myChar = GetCharacter(LocalPlayer)
	if not myChar or not myChar:FindFirstChild("HumanoidRootPart") then return targets end

	local myPos = myChar.HumanoidRootPart.Position

	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= LocalPlayer then
			local char = GetCharacter(player)
			local hrp = char and char:FindFirstChild("HumanoidRootPart")
			if hrp and (hrp.Position - myPos).Magnitude <= auraRange then
				table.insert(targets, player)
			end
		end
	end

	return targets
end

-- MAIN LOOP
task.spawn(function()
	while running do
		local char = GetCharacter(LocalPlayer)
		if not char then task.wait() continue end

		for _, tool in ipairs(char:GetChildren()) do
			if tool:IsA("Tool") and tool:FindFirstChild("FightEvent") then
				tool:Activate()
				for _, target in ipairs(GetTargets()) do
					tool.FightEvent:FireServer()
				end
			end
		end

		task.wait(attackRate)
	end
end)

-- CLEANUP ON DEATH
LocalPlayer.CharacterAdded:Connect(function()
	task.wait(1)
	running = true
end)
