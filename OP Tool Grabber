-- ⚡ ULTIMATE TOOL GRABBER ⚡

----------------------------------------------------------------
-- SERVICES
----------------------------------------------------------------
local Players    = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Tycoons     = workspace:WaitForChild("Tycoons")

----------------------------------------------------------------
-- CONFIG (TUNED FOR REAL NETWORK LIMITS)
----------------------------------------------------------------
local TOUCH_BURST_COUNT = 6        -- touches per pad per burst
local BURST_INTERVAL   = 0.028    -- ~36 bursts/sec (sweet spot for ping stability)
local MAX_INITIAL_TIME = 2.5      -- how long to full-burst after spawn

----------------------------------------------------------------
-- BASE FILTER
----------------------------------------------------------------
local allowedBases  = { "Stone", "Magic", "Storm" }
local excludedBases = { "Insanity","Giant","Dark","Spike","Web","Strong" }

local allowedSet, excludedSet = {}, {}
for _, b in ipairs(allowedBases)  do allowedSet[b]  = true end
for _, b in ipairs(excludedBases) do excludedSet[b] = true end

----------------------------------------------------------------
-- INTERNAL STATE
----------------------------------------------------------------
local pads = {}
local root
local running = false

----------------------------------------------------------------
-- UTILITIES
----------------------------------------------------------------

local function getRoot()
	local c = LocalPlayer.Character
	return c and c:FindFirstChild("HumanoidRootPart")
end

local function hasTools()
	local bp = LocalPlayer:FindFirstChild("Backpack")
	return bp and #bp:GetChildren() > 0
end

----------------------------------------------------------------
-- PAD COLLECTION
----------------------------------------------------------------

local function registerPad(pad)
	local base = pad.Parent and pad.Parent.Parent
	if not base then return end

	local name = base.Name
	if excludedSet[name] then return end

	if allowedSet[name] or not excludedSet[name] then
		pads[pad] = true
	end
end

-- initial scan
for _, d in ipairs(Tycoons:GetDescendants()) do
	if d:IsA("TouchTransmitter")
		and d.Parent
		and d.Parent.Parent
		and d.Parent.Parent.Name:find("GearGiver1")
	then
		registerPad(d.Parent)
	end
end

-- live updates
Tycoons.DescendantAdded:Connect(function(d)
	if d:IsA("TouchTransmitter")
		and d.Parent
		and d.Parent.Parent
		and d.Parent.Parent.Name:find("GearGiver1")
	then
		registerPad(d.Parent)
	end
end)

----------------------------------------------------------------
-- CORE TOUCH LOGIC
----------------------------------------------------------------

local function touchPad(pad)
	for i = 1, TOUCH_BURST_COUNT do
		firetouchinterest(root, pad, 0)
		firetouchinterest(root, pad, 1)
	end
end

----------------------------------------------------------------
-- BURST FUNCTION
----------------------------------------------------------------

local function burstAll()
	if not root then return end

	for pad in pairs(pads) do
		touchPad(pad)
	end
end

----------------------------------------------------------------
-- RESPAWN OVERDRIVE
----------------------------------------------------------------

local function onRespawn()

	-- acquire HRP instantly
	task.spawn(function()
		local char = LocalPlayer.Character
		if not char then return end
		char:WaitForChild("HumanoidRootPart", 5)
		root = char:FindFirstChild("HumanoidRootPart")
	end)

	local t0 = os.clock()

	-- aggressive burst phase
	while os.clock() - t0 < MAX_INITIAL_TIME do
		if hasTools() then break end
		burstAll()
		task.wait(BURST_INTERVAL)
	end

end

LocalPlayer.CharacterAdded:Connect(onRespawn)

----------------------------------------------------------------
-- ALWAYS-ON LOW-OVERHEAD LOOP
----------------------------------------------------------------

task.spawn(function()
	running = true

	while running do

		root = root or getRoot()

		if root and not hasTools() then
			burstAll()
		end

		task.wait(BURST_INTERVAL)
	end

end)

----------------------------------------------------------------
-- IMMEDIATE EXECUTION BURST
----------------------------------------------------------------

task.spawn(function()

	task.wait(0.15) -- small delay to allow HRP init
	root = getRoot()

	for _ = 1, 8 do
		burstAll()
		task.wait(0.02)
	end

end)

----------------------------------------------------------------
print("⚡ ULTIMATE TOOL GRABBER INITILIZED ⚡")
