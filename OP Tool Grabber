-- ⚡ ULTRA-INSTANT TOOL GRABBER— ZERO-DEATH LATENCY EDITION ⚡
-- This is tuned for MAXIMUM safe throughput without crossing into freeze/crash territory.

local Players       = game:GetService("Players")
local RunService    = game:GetService("RunService")
local LocalPlayer   = Players.LocalPlayer
local Tycoons       = workspace:WaitForChild("Tycoons")

-- === CONFIG (MAX POWER) ===
local SUBFRAME_BURSTS      = 9       -- how many bursts inside a single frame
local TOUCH_SPAM_COUNT     = 6       -- firetouchinterest spam per burst
local RESPAWN_SPAM_TIME    = 2.5     -- time window after spawn to spam as hard as possible
local GLOBAL_SPAM_INTERVAL = 0       -- 0 delay = as fast as executor allows
local GRAB_STOP_DELAY      = 0.05    -- short pause before checking tool completion

-- SELECT WHICH BASES YOU WANT
local allowedBases  = { "Stone", "Magic", "Storm" }
local excludedBases = { "Insanity", "Giant", "Dark", "Spike", "Web", "Strong" }

-- === INTERNALS ===
local allowedSet, excludedSet = {}, {}
for _, b in ipairs(allowedBases) do allowedSet[b] = true end
for _, b in ipairs(excludedBases) do excludedSet[b] = true end

local pads = {}
local root
local hardcoreMode = false
local collectedOnce = false

-- === UTILS ===
local function firePad(root, pad)
    for i = 1, TOUCH_SPAM_COUNT do
        task.defer(firetouchinterest, root, pad, 0)
        task.defer(firetouchinterest, root, pad, 1)
    end
end

local function getRoot()
    local c = LocalPlayer.Character
    return c and c:FindFirstChild("HumanoidRootPart")
end

local function hasTools()
    local bp = LocalPlayer.Backpack
    if not bp then return false end
    return #bp:GetChildren() > 0
end

local function registerPad(pad)
    local baseModel = pad.Parent and pad.Parent.Parent
    if not baseModel then return end

    local name = baseModel.Name
    if excludedSet[name] then return end
    if allowedSet[name] or not excludedSet[name] then
        pads[pad] = true
    end
end

-- === PAD SCAN ===
for _, d in ipairs(Tycoons:GetDescendants()) do
    if d:IsA("TouchTransmitter") and d.Parent and d.Parent.Parent and d.Parent.Parent.Name:find("GearGiver1") then
        registerPad(d.Parent)
    end
end

Tycoons.DescendantAdded:Connect(function(d)
    if d:IsA("TouchTransmitter") and d.Parent and d.Parent.Parent and d.Parent.Parent.Name:find("GearGiver1") then
        registerPad(d.Parent)
    end
end)

-- === HARDCORE BURST FUNCTION ===
local function fullBlastCollectors()
    root = getRoot()
    if not root then return end

    for pad in pairs(pads) do
        task.defer(function()
            for _ = 1, SUBFRAME_BURSTS do
                firePad(root, pad)
            end
        end)
    end
end

-- === RESPAWN OVERDRIVE CYCLE ===
local function onRespawn()
    root = nil
    hardcoreMode = true

    -- wait until HRP exists the *moment* it appears
    task.spawn(function()
        local char = LocalPlayer.Character
        if not char then return end
        char:WaitForChild("HumanoidRootPart", 3)
        root = char:FindFirstChild("HumanoidRootPart")
    end)

    -- FULL POWER SPAM for first 2.5s
    local t0 = time()
    while time() - t0 < RESPAWN_SPAM_TIME do
        fullBlastCollectors()
        task.wait(GLOBAL_SPAM_INTERVAL)

        -- stop early if we actually grabbed tools
        if hasTools() then
            hardcoreMode = false
            collectedOnce = true
            break
        end
    end

    hardcoreMode = false
end

-- === CHARACTER ADDED ===
LocalPlayer.CharacterAdded:Connect(function()
    task.defer(onRespawn)
end)

-- === PER-FRAME INSTA-SPAM LOOP (never stops) ===
RunService.Heartbeat:Connect(function()
    root = root or getRoot()
    if not root then return end

    -- ALWAYS spam tools every frame
    for pad in pairs(pads) do
        task.defer(function()
            for _ = 1, SUBFRAME_BURSTS do
                firePad(root, pad)
            end
        end)
    end
end)

print("⚡ ULTRA-INSTANT TOOL GRABBER — ZERO-DEATH LATENCY EDITION Loaded ⚡")
