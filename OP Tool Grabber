-- ⚡ ULTRA-INSTANT TOOL GRABBER ⚡
-- Designed for subframe-level tool acquisition the exact moment you spawn.

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Tycoons = workspace:WaitForChild("Tycoons")

-- ======================
-- CONFIGURATION (EXTREME)
-- ======================
local TOUCH_BURSTS = 6             -- subframe bursts per pad (higher = faster)
local PHASE_CYCLES = 5             -- engine-phase loops inside each burst
local RESPAWN_SUPERBURST_TIME = 1  -- seconds of ultra-aggressive grabbing after spawn
local PAD_REFRESH_RATE = 0.75      -- how often pads are rescanned (performance safe)
local BURST_DELAY = 0.0001         -- absolute minimum safe yield

-- ======================
-- INTERNAL SETS & STATE
-- ======================
local pads = {}               -- cached pad parts
local active = false          -- true while bursts are running
local root = nil              -- HRP reference
local respawnTime = 0         -- timestamp of last respawn
local requiredTools = {       -- tools we expect to pick up instantly
    "Energy Sword", "Fist", "Axe", "Staff"
}

local requiredSet = {}
for _, t in ipairs(requiredTools) do
    requiredSet[t] = true
end

-- ======================
-- PAD REGISTRATION LOGIC
-- ======================
local function registerPad(pad)
    if not pad then return end
    pads[pad] = true
end

local function scanPads()
    for _, v in ipairs(Tycoons:GetDescendants()) do
        if v:IsA("TouchTransmitter") then
            registerPad(v.Parent)
        end
    end
end

scanPads()
Tycoons.DescendantAdded:Connect(function(desc)
    if desc:IsA("TouchTransmitter") then
        registerPad(desc.Parent)
    end
end)

-- ======================
-- FAST UTILITY HELPERS
-- ======================
local function hasAllTools()
    local backpack = LocalPlayer:FindFirstChild("Backpack")
    if backpack then
        for _, item in ipairs(backpack:GetChildren()) do
            if requiredSet[item.Name] then
                return true
            end
        end
    end
    return false
end

local function fireTouch(root, pad)
    task.defer(firetouchinterest, root, pad, 0)
    task.defer(firetouchinterest, root, pad, 1)
end

local function subframeBurst(root, pad)
    for i = 1, TOUCH_BURSTS do

        -- Multi-phase cycle to bypass engine throttles
        fireTouch(root, pad)
        RunService.PreAnimation:Wait()
        fireTouch(root, pad)
        RunService.PreSimulation:Wait()
        fireTouch(root, pad)
        RunService.Heartbeat:Wait()
        fireTouch(root, pad)
        RunService.PostSimulation:Wait()
        fireTouch(root, pad)

        task.wait(BURST_DELAY)
    end
end

-- ======================
-- MAIN ULTRA-GRAB ENGINE
-- ======================
local function runBurstCycle()
    if active or not root then return end
    active = true

    -- Only aggressively collect if we don't have tools
    if hasAllTools() then
        active = false
        return
    end

    for pad in pairs(pads) do
        task.spawn(function()
            subframeBurst(root, pad)
        end)
    end

    active = false
end

-- ======================
-- RESPAWN WATCHER (INSTANT)
-- ======================
local function onSpawn(char)
    root = nil
    respawnTime = os.clock()

    task.spawn(function()
        local hrp = char:WaitForChild("HumanoidRootPart", 1)
        root = hrp

        local start = os.clock()
        while os.clock() - start < RESPAWN_SUPERBURST_TIME do
            runBurstCycle()
            task.wait(0.02)
        end
    end)
end

LocalPlayer.CharacterAdded:Connect(onSpawn)
if LocalPlayer.Character then
    onSpawn(LocalPlayer.Character)
end

-- ======================
-- CONTINUOUS MINIMAL LOOP
-- ======================
task.spawn(function()
    while true do
        if root and not hasAllTools() then
            runBurstCycle()
        end
        task.wait(0.15)
    end
end)

-- ======================
-- PERIODIC PAD RESCAN
-- ======================
task.spawn(function()
    while true do
        scanPads()
        task.wait(PAD_REFRESH_RATE)
    end
end)

print("Tool Grabber Initilized")
