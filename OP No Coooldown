-- ‚ö° MAX-POWER NO COOLDOWN (Ping-Tuned, Frame-Edge, Overflow-Protected)

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local Stats = game:GetService("Stats")

local LocalPlayer = Players.LocalPlayer
local networkPing = 0.02
local cachedEnemies = {}

-- üîÅ hook optimizations
hookfunction(wait, function() return RunService.RenderStepped:Wait() end)
hookfunction(task.wait, function() return RunService.RenderStepped:Wait() end)
hookfunction(delay, function(_, f) task.defer(f) end)
hookfunction(spawn, function(f) task.defer(f) end)

-- üß† maintain optimized cache of enemies
local function rebuildCache()
	table.clear(cachedEnemies)
	for _, plr in ipairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer and plr.Character then
			local hrp = plr.Character:FindFirstChild("HumanoidRootPart")
			if hrp then
				cachedEnemies[#cachedEnemies + 1] = hrp
			end
		end
	end
end
Players.PlayerAdded:Connect(rebuildCache)
Players.PlayerRemoving:Connect(rebuildCache)
RunService.Heartbeat:Connect(function()
	for _, plr in ipairs(Players:GetPlayers()) do
		local c = plr.Character and plr.Character:FindFirstChild("HumanoidRootPart")
		if plr ~= LocalPlayer and c and not table.find(cachedEnemies, c) then
			rebuildCache()
			break
		end
	end
end)

-- ‚ö° MAIN ATTACK LOOP
local maxRange = 20
local minTick = 0.002  -- üî• ultra low delay floor
local last = 0
local nextSend = 0

RunService.RenderStepped:Connect(function(dt)
	local now = os.clock()
	if now < nextSend then return end

	local char = LocalPlayer.Character
	if not char then return end
	local hrp = char:FindFirstChild("HumanoidRootPart")
	local tool = char:FindFirstChildOfClass("Tool")
	if not (hrp and tool) then return end

	local fightEvent = tool:FindFirstChild("FightEvent")
	if not fightEvent then return end

	-- ‚öôÔ∏è ping tuning
	local pingStat = Stats.Network.ServerStatsItem["Data Ping"]
	local ping = pingStat and pingStat:GetValue() / 1000 or networkPing
	local interval = math.clamp(ping * 0.75, minTick, 0.03) -- push just below safe ping window
	nextSend = now + interval

	-- üîÅ fire to all enemies in range
	for _, enemy in ipairs(cachedEnemies) do
		if (hrp.Position - enemy.Position).Magnitude <= maxRange then
			fightEvent:FireServer(enemy)
		end
	end
end)

print("‚úÖ MAX-POWER NO COOLDOWN loaded (RenderStepped + adaptive fire loop)")
